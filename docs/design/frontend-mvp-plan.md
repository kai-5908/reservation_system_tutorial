# フロントエンドMVP実装方針（予約フロー）

## 前提
- 技術スタック: Create React App (React 18)、状態管理ライブラリなし（必要に応じて Hooks）、UI ライブラリなし。
- API は最新仕様に即追随（空き枠レスポンス `items` ラップ、予約一覧 `status` フィルタ）。互換レイヤーは不要。
- 認証トークンはローカルストレージで保持し、401 はログイン画面誘導を想定。
- 日時は JST 入力/表示（API 前提に合わせる）。

## ゴール（MVP）
- 空き枠検索 → スロット選択 → 予約 → マイページで確認/キャンセル/リスケが通しで動く。
- カットオフ/バージョン競合などサーバ起因エラーをユーザーにわかりやすく通知。
- 監査ログはサーバ側で出力済み。フロントは Request-ID を自動付与（ミドルウェアで設定済み）とトースト/ダイアログでのエラー表示に留める。

## 実装・設計タスク（段階分け）

### 1. インフラ/共通（最初に）
- API クライアント層の整備（fetch/axios などの薄いラッパ）。Bearer トークンの注入、401 時のログイン誘導。  
- 共通のエラーハンドリング（403/404/409/500 をトースト表示）。If-Match 409 は「更新競合」として再読込を促す。

### 2. 空き枠検索・選択
- 検索フォーム: 店舗ID、期間（JST）、座席ID任意。期間は日付＋時間指定のピッカー。  
- 結果表示: `items` 配下のスロット一覧をカード/リストで表示し、`remaining` を明示。選択で `slot_id` を保持。

### 3. 予約作成フロー
- 選択済み `slot_id` + party_size 入力で予約 API を呼ぶ。成功時はマイページへ遷移しトーストで完了表示。  
- 失敗（404/409）はトースト表示のみ（再選択を促す）。

### 4. マイページ（一覧/詳細/キャンセル/リスケ）
- 一覧: `status` フィルタ（booked/cancelled）。必要なら日付フィルタは後回し。  
- 詳細: スロット開始・終了、席、人数、version を表示。  
- キャンセル: If-Match に version を付けて実行。403（カットオフ）、409（バージョン競合）をトースト表示。  
- リスケ: 空き枠検索と同様のUIで新 `slot_id` を選択し、If-Match version で実行。同一ショップ縛りとカットオフのエラーを表示。

### 5. テストとドキュメント
- E2E: ハッピーパス1本（検索→予約→キャンセル、もしくはリスケ）。  
- README/開発手順: トークン発行、シードデータ利用、API契約（items/statusフィルタ）を簡潔に追記。

## 判断理由（ざっくり）
- 互換レイヤーなしで即追随: バックエンドが既に変更済みで、フロント側で分岐を持つコストを避けるため。  
- JST固定: API前提と一致させ、タイムゾーン選択のUXとバグ要因を排除。  
- トークンをローカルストレージ: 実装を最小にし、MVPでの速度を優先（将来Cookie化は別検討）。  
- 一覧フィルタはステータス優先: MVPでの主要操作が booked の確認/取消/リスケに集中するため。  
- E2Eはハッピーパス1本: まず通しの顧客体験を保証し、複雑なシナリオは後続で追加するため。
