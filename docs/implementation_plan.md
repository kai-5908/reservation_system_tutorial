# 予約機能 実装プラン

## スコープ
- 予約枠を事前に定義し、その枠から予約する機能。基本的なキャンセル/変更ルールを含む。
- 優先度: UI よりも整合性（ダブルブッキング防止・正しさ）を最優先。

## 機能分割とリスク
1. 予約枠モデル/制約（時間帯、収容/席、ステータス） — リスク: 中
2. 空き枠検索（ユーザー向け） — リスク: 中
3. 予約作成 API（単発予約） — リスク: 高
4. 同時実行/整合性ガード（ロック/一意制約） — リスク: 高
5. ステータス管理/キャンセル・基本変更ルール — リスク: 中
6. 最小限の認証/認可（本人予約のみ許可） — リスク: 中
7. 予約確認（ユーザーの一覧/詳細取得） — リスク: 低
8. 監査/ログ（任意） — リスク: 低

## 依存関係（→ は依存先）
- 予約枠モデル → 基盤
- 空き枠検索 → 予約枠モデル
- 同時実行/整合性ガード → 予約枠モデル
- 予約作成 → 予約枠モデル, 同時実行/整合性ガード
- ステータス/キャンセル/変更 → 予約作成
- 認証/認可（最小） → 予約作成, 予約確認
- 予約確認 → 予約作成, 認証/認可
- 監査/ログ → 予約作成, ステータス/キャンセル/変更

## 実装の推奨順序
1) 予約枠モデル/制約 → 2) 空き枠検索 → 3) 予約作成 + 同時実行/整合性ガード（セットで設計） → 4) ステータス/キャンセルの基本 → 5) 最小限の認証/認可 → 6) 予約確認 → 7) 監査/ログ（必要なら）。
